# Cr√©ation et int√©gration d'outils pour votre agent

Dans cette section, nous allons donner √† Alfred l'acc√®s au web, lui permettant de trouver les derni√®res nouvelles et mises √† jour mondiales. 
De plus, il aura acc√®s aux donn√©es m√©t√©orologiques et aux statistiques de t√©l√©chargement des mod√®les du Hub d'Hugging Face Hub, pour qu'il puisse faire des conversations pertinentes sur des sujets frais.

## Donnez √† votre agent l'acc√®s au web

Rappelez-vous que nous voulons qu'Alfred √©tablisse sa pr√©sence comme un v√©ritable h√¥te de la renaissance, avec une connaissance approfondie du monde.

Pour ce faire, nous devons nous assurer qu'Alfred a acc√®s aux derni√®res nouvelles et informations sur le monde.

Commen√ßons par cr√©er un outil de recherche web pour Alfred !

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import DuckDuckGoSearchTool

# Initialiser l'outil de recherche DuckDuckGo
search_tool = DuckDuckGoSearchTool()

# Exemple d'usage
results = search_tool("Qui est l'actuel Pr√©sident de la France ?")
print(results)
```

Sortie attendue :

```
L'actuel Pr√©sident de la France est Emmanuel Macron.
```

</hfoption>
<hfoption id="llama-index">

```python
from llama_index.tools.duckduckgo import DuckDuckGoSearchToolSpec
from llama_index.core.tools import FunctionTool

# Initialiser l'outil de recherche DuckDuckGo
tool_spec = DuckDuckGoSearchToolSpec()

search_tool = FunctionTool.from_defaults(tool_spec.duckduckgo_full_search)
# Exemple d'usage
response = search_tool("Qui est l'actuel Pr√©sident de la France ?")
print(response.raw_output[-1]['body'])
```

Sortie attendue :

```
Le Pr√©sident de la R√©publique fran√ßaise est le chef d'√âtat de la France. L'actuel Pr√©sident est Emmanuel Macron depuis le 14 mai 2017 apr√®s avoir battu Marine Le Pen au second tour de l'√©lection pr√©sidentielle le 7 mai 2017. Liste des pr√©sidents fran√ßais (Cinqui√®me R√©publique) N¬∞ Portrait Nom ...
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain_community.tools import DuckDuckGoSearchRun

search_tool = DuckDuckGoSearchRun()
results = search_tool.invoke("Qui est l'actuel Pr√©sident de la France ?")
print(results)
```

Sortie attendue :

```
Emmanuel Macron (n√© le 21 d√©cembre 1977 √† Amiens, France) est un banquier et homme politique fran√ßais qui a √©t√© √©lu pr√©sident de la France en 2017...
```

</hfoption>
</hfoptions>

## Cr√©ation d'un outil personnalis√© pour les informations m√©t√©orologiques afin de programmer le feu d'artifice

Le gala parfait aurait un feu d'artifice dans un ciel clair, nous devons nous assurer qu'il ne soit pas annul√© √† cause du mauvais temps.

Cr√©ons un outil personnalis√© qui peut √™tre utilis√© pour appeler une API m√©t√©o externe et obtenir les informations pour un lieu donn√©.

> [!TIP]
> Par souci de simplicit√©, nous utilisons une API m√©t√©orologique factice pour cet exemple. Si vous voulez utiliser une v√©ritable API, vous pourriez impl√©menter un outil utilisant l'API OpenWeatherMap comme dans <a href="../../unit1/tutorial">l'Unit√© 1</a>.

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import Tool
import random

class WeatherInfoTool(Tool):
    name = "weather_info"
    description = "R√©cup√®re des informations m√©t√©orologiques factices pour un lieu donn√©."
    inputs = {
        "location": {
            "type": "string",
            "description": "Le lieu pour lequel obtenir les informations m√©t√©orologiques."
        }
    }
    output_type = "string"

    def forward(self, location: str):
        # Donn√©es m√©t√©orologiques factices
        weather_conditions = [
            {"condition": "Pluvieux", "temp_c": 15},
            {"condition": "Clair", "temp_c": 25},
            {"condition": "Venteux", "temp_c": 20}
        ]
        # S√©lectionner al√©atoirement une condition m√©t√©orologique
        data = random.choice(weather_conditions)
        return f"M√©t√©o √† {location}: {data['condition']}, {data['temp_c']}¬∞C"

# Initialiser l'outil
weather_info_tool = WeatherInfoTool()
```

</hfoption>
<hfoption id="llama-index">

```python
import random
from llama_index.core.tools import FunctionTool

def get_weather_info(location: str) -> str:
    """R√©cup√®re des informations m√©t√©orologiques factices pour un lieu donn√©."""
    # Donn√©es m√©t√©orologiques factices
    weather_conditions = [
        {"condition": "Pluvieux", "temp_c": 15},
        {"condition": "Clair", "temp_c": 25},
        {"condition": "Venteux", "temp_c": 20}
    ]
    # S√©lectionner al√©atoirement une condition m√©t√©orologique
    data = random.choice(weather_conditions)
    return f"M√©t√©o √† {location}: {data['condition']}, {data['temp_c']}¬∞C"

# Initialiser l'outil
weather_info_tool = FunctionTool.from_defaults(get_weather_info)
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain.tools import Tool
import random

def get_weather_info(location: str) -> str:
    """R√©cup√®re des informations m√©t√©orologiques factices pour un lieu donn√©."""
    # Donn√©es m√©t√©orologiques factices
    weather_conditions = [
        {"condition": "Pluvieux", "temp_c": 15},
        {"condition": "Clair", "temp_c": 25},
        {"condition": "Venteux", "temp_c": 20}
    ]
    # S√©lectionner al√©atoirement une condition m√©t√©orologique
    data = random.choice(weather_conditions)
    return f"M√©t√©o √† {location}: {data['condition']}, {data['temp_c']}¬∞C"

# Initialiser l'outil
weather_info_tool = Tool(
    name="get_weather_info",
    func=get_weather_info,
    description="R√©cup√®re des informations m√©t√©orologiques factices pour un lieu donn√©."
)
```

</hfoption>
</hfoptions>

## Cr√©ation d'un outil pour obtenir les statistiques du Hub concernant les constructeurs d'IA influents

Le gala r√©unit le gratin des constructeurs d'IA. Alfred veut les impressionner en discutant de leurs mod√®les, jeux de donn√©es et Spaces les plus populaires. Nous cr√©erons un outil pour r√©cup√©rer les statistiques des mod√®les du Hub √† partir d'un nom d'utilisateur.

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import Tool
from huggingface_hub import list_models

class HubStatsTool(Tool):
    name = "hub_stats"
    description = "R√©cup√®re le mod√®le le plus t√©l√©charg√© d'un auteur sp√©cifique sur le Hugging Face Hub."
    inputs = {
        "author": {
            "type": "string",
            "description": "Le nom d'utilisateur de l'auteur/organisation du mod√®le pour trouver des mod√®les."
        }
    }
    output_type = "string"

    def forward(self, author: str):
        try:
            # Lister les mod√®les de l'auteur sp√©cifi√©, tri√©s par t√©l√©chargements
            models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))
            
            if models:
                model = models[0]
                return f"Le mod√®le le plus t√©l√©charg√© par {author} est {model.id} avec {model.downloads:,} t√©l√©chargements."
            else:
                return f"Aucun mod√®le trouv√© pour l'auteur {author}."
        except Exception as e:
            return f"Erreur lors de la r√©cup√©ration des mod√®les pour {author}: {str(e)}"

# Initialiser l'outil
hub_stats_tool = HubStatsTool()

# Exemple d'usage
print(hub_stats_tool("facebook")) # Exemple : Obtenir le mod√®le le plus t√©l√©charg√© par Facebook
```

Sortie attendue :

```
Le mod√®le le plus t√©l√©charg√© par facebook est facebook/esmfold_v1 avec 12,544,550 t√©l√©chargements.
```

</hfoption>
<hfoption id="llama-index">

```python
import random
from llama_index.core.tools import FunctionTool
from huggingface_hub import list_models

def get_hub_stats(author: str) -> str:
    """R√©cup√®re le mod√®le le plus t√©l√©charg√© d'un auteur sp√©cifique sur le Hugging Face Hub."""
    try:
        # Lister les mod√®les de l'auteur sp√©cifi√©, tri√©s par t√©l√©chargements
        models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))

        if models:
            model = models[0]
            return f"Le mod√®le le plus t√©l√©charg√© par {author} est {model.id} avec {model.downloads:,} t√©l√©chargements."
        else:
            return f"Aucun mod√®le trouv√© pour l'auteur {author}."
    except Exception as e:
        return f"Erreur lors de la r√©cup√©ration des mod√®les pour {author}: {str(e)}"

# Initialiser l'outil
hub_stats_tool = FunctionTool.from_defaults(get_hub_stats)

# Exemple d'usage
print(hub_stats_tool("facebook")) # Exemple : Obtenir le mod√®le le plus t√©l√©charg√© par Facebook
```

Sortie attendue :

```
Le mod√®le le plus t√©l√©charg√© par facebook est facebook/esmfold_v1 avec 12,544,550 t√©l√©chargements.
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain.tools import Tool
from huggingface_hub import list_models

def get_hub_stats(author: str) -> str:
    """R√©cup√®re le mod√®le le plus t√©l√©charg√© d'un auteur sp√©cifique sur le Hugging Face Hub."""
    try:
        # Lister les mod√®les de l'auteur sp√©cifi√©, tri√©s par t√©l√©chargements
        models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))

        if models:
            model = models[0]
            return f"Le mod√®le le plus t√©l√©charg√© par {author} est {model.id} avec {model.downloads:,} t√©l√©chargements."
        else:
            return f"Aucun mod√®le trouv√© pour l'auteur {author}."
    except Exception as e:
        return f"Erreur lors de la r√©cup√©ration des mod√®les pour {author}: {str(e)}"

# Initialiser l'outil
hub_stats_tool = Tool(
    name="get_hub_stats",
    func=get_hub_stats,
    description="R√©cup√®re le mod√®le le plus t√©l√©charg√© d'un auteur sp√©cifique sur le Hugging Face Hub."
)

# Exemple d'usage
print(hub_stats_tool.invoke("facebook")) # Exemple : Obtenir le mod√®le le plus t√©l√©charg√© par Facebook
```

Sortie attendue :

```
Le mod√®le le plus t√©l√©charg√© par facebook est facebook/esmfold_v1 avec 13 109 861 t√©l√©chargements.
```

</hfoption>
</hfoptions>

Avec l'outil de statistiques, Alfred peut maintenant impressionner les constructeurs d'IA influents en discutant de leurs mod√®les les plus populaires.

## Int√©gration des outils

Maintenant que nous avons tous les outils, int√©grons-les dans l'agent d'Alfred :

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import CodeAgent, InferenceClientModel

# Initialiser le mod√®le Hugging Face
model = InferenceClientModel()

# Cr√©er Alfred avec tous les outils
alfred = CodeAgent(
    tools=[search_tool, weather_info_tool, hub_stats_tool], 
    model=model
)

# Exemple de requ√™te qu'Alfred pourrait recevoir pendant le gala
response = alfred.run("Qu'est-ce que Facebook et quel est leur mod√®le le plus populaire ?")

print("üé© R√©ponse d'Alfred :")
print(response)
```

Sortie attendue :

```
üé© R√©ponse d'Alfred :
Facebook est un site web de r√©seau social o√π les utilisateurs peuvent se connecter, partager des informations et interagir avec d'autres. Le mod√®le le plus t√©l√©charg√© par Facebook sur le Hugging Face Hub est ESMFold_v1.
```

</hfoption>
<hfoption id="llama-index">

```python
from llama_index.core.agent.workflow import AgentWorkflow
from llama_index.llms.huggingface_api import HuggingFaceInferenceAPI

# Initialiser le mod√®le Hugging Face
llm = HuggingFaceInferenceAPI(model_name="Qwen/Qwen2.5-Coder-32B-Instruct")
# Cr√©er Alfred avec tous les outils
alfred = AgentWorkflow.from_tools_or_functions(
    [search_tool, weather_info_tool, hub_stats_tool],
    llm=llm
)

# Exemple de requ√™te qu'Alfred pourrait recevoir pendant le gala
response = await alfred.run("Qu'est-ce que Facebook et quel est leur mod√®le le plus populaire ?")

print("üé© R√©ponse d'Alfred :")
print(response)
```

Sortie attendue :

```
üé© R√©ponse d'Alfred :
Facebook est un service de r√©seau social et une entreprise technologique bas√©e √† Menlo Park, en Californie. Elle a √©t√© fond√©e par Mark Zuckerberg et permet aux gens de cr√©er des profils, se connecter avec des amis et la famille, partager des photos et vid√©os, et rejoindre des groupes bas√©s sur des int√©r√™ts partag√©s. Le mod√®le le plus populaire par Facebook sur le Hugging Face Hub est facebook/esmfold_v1 avec 13 109 861 t√©l√©chargements.
```

</hfoption>
<hfoption id="langgraph">

```python
from typing import TypedDict, Annotated
from langgraph.graph.message import add_messages
from langchain_core.messages import AnyMessage, HumanMessage, AIMessage
from langgraph.prebuilt import ToolNode
from langgraph.graph import START, StateGraph
from langgraph.prebuilt import tools_condition
from langchain_huggingface import HuggingFaceEndpoint, ChatHuggingFace

# G√©n√©rer l'interface de chat, incluant les outils
llm = HuggingFaceEndpoint(
    repo_id="Qwen/Qwen2.5-Coder-32B-Instruct",
    huggingfacehub_api_token=HUGGINGFACEHUB_API_TOKEN,
)

chat = ChatHuggingFace(llm=llm, verbose=True)
tools = [search_tool, weather_info_tool, hub_stats_tool]
chat_with_tools = chat.bind_tools(tools)

# G√©n√©rer l'AgentState et le graphe d'agent
class AgentState(TypedDict):
    messages: Annotated[list[AnyMessage], add_messages]

def assistant(state: AgentState):
    return {
        "messages": [chat_with_tools.invoke(state["messages"])],
    }

## Le graphe
builder = StateGraph(AgentState)

# D√©finir les n≈ìuds : ils font le travail
builder.add_node("assistant", assistant)
builder.add_node("tools", ToolNode(tools))

# D√©finir les ar√™tes : elles d√©terminent comment le flux de contr√¥le se d√©place
builder.add_edge(START, "assistant")
builder.add_conditional_edges(
    "assistant",
    # Si le dernier message n√©cessite un outil, router vers les outils
    # Sinon, fournir une r√©ponse directe
    tools_condition,
)
builder.add_edge("tools", "assistant")
alfred = builder.compile()

messages = [HumanMessage(content="Qui est Facebook et quel est leur mod√®le le plus populaire ?")]
response = alfred.invoke({"messages": messages})

print("üé© R√©ponse d'Alfred :")
print(response['messages'][-1].content)
```

Sortie attendue :

```
üé© R√©ponse d'Alfred :
Facebook est une entreprise de m√©dias sociaux connue pour son site de r√©seau social, Facebook, ainsi que d'autres services comme Instagram et WhatsApp. Le mod√®le le plus t√©l√©charg√© par Facebook sur le Hugging Face Hub est facebook/esmfold_v1 avec 13 202 321 t√©l√©chargements.
```
</hfoption>
</hfoptions>

## Conclusion

En int√©grant ces outils, Alfred est maintenant √©quip√© pour g√©rer une vari√©t√© de t√¢ches, des recherches web aux mises √† jour m√©t√©orologiques et aux statistiques de mod√®les. Cela garantit qu'il reste l'h√¥te le plus inform√© et engageant du gala.

> [!TIP]
> Essayez d'impl√©menter un outil qui peut √™tre utilis√© pour obtenir les derni√®res nouvelles sur un sujet sp√©cifique.
>
> Quand vous avez termin√©, impl√©mentez vos outils personnalis√©s dans le fichier <code>tools.py</code>.